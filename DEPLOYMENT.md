# AnkleCapture Deployment Guide

## 🚀 GitHub Pagesへのデプロイ手順

### ステップ1: GitHubリポジトリの作成

1. **GitHubにアクセス** → https://github.com
2. **新規リポジトリを作成**
   - 右上の「+」→「New repository」をクリック
   - Repository name: `ankle-measurement` (または任意の名前)
   - Description: `AnkleCapture - 足関節角度測定WebApp`
   - **Public** を選択（GitHub Pagesは無料版ではPublicが必要）
   - **「Initialize this repository」のチェックは全て外す**（既存のコードがあるため）
   - 「Create repository」をクリック

### ステップ2: リモートリポジトリの追加とプッシュ

ターミナルで以下のコマンドを実行：

```bash
# リモートリポジトリを追加（URLは自分のリポジトリに変更）
git remote add origin https://github.com/[ユーザー名]/ankle-measurement.git

# mainブランチを設定
git branch -M main

# プッシュ
git push -u origin main
```

> 💡 **ヒント**: GitHubのリポジトリページに表示される「Quick setup」セクションのコマンドをコピーすると便利です

### ステップ3: GitHub Pagesの有効化

1. GitHubリポジトリページで **Settings** タブをクリック
2. 左サイドバーの **Pages** をクリック
3. **Source** セクションで:
   - Branch: `main` を選択
   - Folder: `/ (root)` を選択
   - 「Save」をクリック

4. **数分後**、同じページに緑色のバーが表示され、URLが表示されます:
   ```
   Your site is live at https://[ユーザー名].github.io/ankle-measurement/
   ```

### ステップ4: webappディレクトリへのアクセス設定

GitHub Pagesのデフォルトは `/` ですが、アプリは `/webapp/` にあるため、URLは:

```
https://[ユーザー名].github.io/ankle-measurement/webapp/
```

### ✨ オプション: ルートディレクトリでの公開

もし `https://[ユーザー名].github.io/ankle-measurement/` で直接アクセスしたい場合：

**方法A: webappを`docs`に移動してGitHub Pages設定変更**

```bash
# webappディレクトリをdocsにリネーム
mv webapp docs

# コミット
git add .
git commit -m "Move webapp to docs for GitHub Pages"
git push

# GitHub Settings > Pages で Folder を `/docs` に変更
```

**方法B: webappの内容をルートに移動**

```bash
# webappの内容をルートに移動
mv webapp/* .
mv webapp/.* . 2>/dev/null || true
rmdir webapp

# コミット
git add .
git commit -m "Move webapp to root for direct access"
git push
```

---

## 📱 iPhoneでのテスト手順

### 前提条件
- iPhone (iOS 13以降推奨)
- Safari ブラウザ
- Wi-Fi接続

### テスト手順

1. **デプロイURLにアクセス**
   
   iPhoneのSafariで以下のURLを開く:
   ```
   https://[ユーザー名].github.io/ankle-measurement/webapp/
   ```

2. **カメラ権限の許可**
   
   初回アクセス時、カメラの使用許可を求められます:
   - 「許可」をタップ

3. **モーションセンサー権限の許可**
   
   水平仪を有効化する際、モーションセンサーの許可を求められます:
   - 「許可」をタップ

4. **基本フローのテスト**
   
   ✅ **画面1: 被験者情報**
   - 被験者ID（例: TEST001）を入力
   - 左脚/右脚を選択
   - 「📷 撮影を開始」をタップ

   ✅ **画面2: カメラ撮影**
   - カメラプレビューが表示されることを確認
   - グリッド（九宮格）が表示されることを確認
   - 足部輪郭ガイドが表示されることを確認
   - 「有効化」ボタンで水平仪を有効化
   - デバイスを傾けると「→」「←」「↑」「↓」が表示されることを確認
   - 4つのステップを「✓ 確認」ボタンで進める
   - Step 4で距離確認モーダルが表示される
   - 「✓ 適切」を選択
   - 「📸 撮影」ボタンが有効化される
   - 撮影ボタンをタップ

   ✅ **画面3: 角度測定**
   - 撮影した画像が表示される
   - 画像上で3点をタップ（腓骨頭、外果、第5中足骨頭）
   - 角度が自動計算される（例: 18.5°）
   - ポイントをドラッグして調整できる
   - 「💾 保存」をタップ

   ✅ **画面4: エクスポート**
   - 測定結果のサマリーが表示される
   - 「📊 CSV形式でダウンロード」をタップ → CSVファイルがダウンロードされる
   - 「🖼️ 画像をダウンロード」をタップ → 2つのPNG画像がダウンロードされる

5. **エッジケースのテスト**
   
   - ブラウザを閉じて再度開く → データが保持されている（IndexedDB）
   - 機内モードでアプリを使用 → オフラインで動作する
   - デバイスを横向きに → UIが適応する

---

## 🔧 トラブルシューティング

### カメラが起動しない

**問題**: 「カメラにアクセスできませんでした」エラー

**解決策**:
1. **HTTPSで接続しているか確認**
   - URLが `https://` で始まっているか確認
   - `http://` では動作しません

2. **カメラ権限を確認**
   - iPhone設定 > Safari > カメラ > 確認
   - 設定 > プライバシーとセキュリティ > カメラ > Safari

3. **他のアプリでカメラを使用していないか確認**
   - カメラアプリや他のブラウザを閉じる

### 水平仪が動作しない

**問題**: 傾き検出が反応しない

**解決策**:
1. **権限を許可**
   - 「有効化」ボタンをタップ
   - 許可ダイアログで「許可」を選択

2. **iOS 13以降であることを確認**
   - 設定 > 一般 > 情報 > ソフトウェアバージョン

3. **デバイスを動かす**
   - センサーが反応するまで少し待つ
   - デバイスを前後左右に傾けてみる

### データが保存されない

**問題**: ブラウザを閉じるとデータが消える

**解決策**:
1. **プライベートブラウズモードを無効化**
   - Safari > 右下のタブアイコン
   - 「プライベート」がオンの場合はオフにする

2. **ストレージ容量を確認**
   - 設定 > 一般 > iPhoneストレージ

### 画像がダウンロードできない

**問題**: ダウンロードボタンを押しても何も起こらない

**解決策**:
1. **ポップアップブロックを確認**
   - Safari設定 > ポップアップブロックがオフになっているか確認

2. **ダウンロードフォルダを確認**
   - ファイルアプリ > ダウンロード

---

## 📊 デプロイ検証チェックリスト

サイトが正常にデプロイされているか確認:

- [ ] HTTPS URLでアクセスできる
- [ ] すべてのCSS/JSファイルが読み込まれる（開発者ツールでエラーなし）
- [ ] カメラ権限ダイアログが表示される
- [ ] カメラプレビューが表示される
- [ ] グリッドとガイドが表示される
- [ ] デバイスモーションの許可ダイアログが表示される
- [ ] 4ステップを完了できる
- [ ] 画像をキャプチャできる
- [ ] 3点マーキングができる
- [ ] 角度が計算される
- [ ] データがエクスポートできる

---

## 🔄 更新のデプロイ

コードを変更した後:

```bash
# 変更をステージング
git add .

# コミット
git commit -m "説明的なコミットメッセージ"

# プッシュ
git push

# GitHub Pagesが自動的に更新（数分かかる場合があります）
```

---

## 📞 サポート

問題が発生した場合:

1. ブラウザのコンソールを確認（Safari > 開発 > Webインスペクタ）
2. エラーメッセージをスクリーンショット
3. デバイス情報を記録（iOSバージョン、Safariバージョン）

---

## 🎉 成功！

デプロイが完了し、iPhoneでテストできました！

次のステップ:
- 実際の被験者で測定を実施
- データの精度を検証
- フィードバックを収集
- 必要に応じて機能を追加
